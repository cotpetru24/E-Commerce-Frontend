<div class="container mt-4">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading your account...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading && userProfile" class="row">
    <div class="col-lg-3">
      <!-- User Profile Card -->
      <div class="card shadow-sm mb-4">
        <div class="card-body text-center">
          <div class="mb-3">
            <div class="position-relative d-inline-block">
              <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center" 
                   style="width: 100px; height: 100px;">
                <i class="bi bi-person-fill text-white" style="font-size: 2rem;"></i>
              </div>
            </div>
          </div>
          <h5 class="card-title">{{ userProfile.firstName }} {{ userProfile.lastName }}</h5>
          <p class="text-muted">{{ userProfile.email }}</p>
          <div class="badge bg-success mb-2">Member since {{ userProfile.joinDate | date:'MMM yyyy' }}</div>
          <button class="btn btn-outline-primary btn-sm" (click)="startEditing()" *ngIf="!isEditing">
            <i class="bi bi-pencil me-2"></i>Edit Profile
          </button>
        </div>
      </div>

      <!-- Navigation Menu -->
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h6 class="mb-0">
            <i class="bi bi-person-gear me-2"></i>Account Menu
          </h6>
        </div>
        <div class="list-group list-group-flush">
          <a class="list-group-item list-group-item-action" 
             [routerLink]="['/user']" 
             routerLinkActive="active">
            <i class="bi bi-person me-2"></i>Profile
          </a>
          <a class="list-group-item list-group-item-action" 
             [routerLink]="['/user/orders']" 
             routerLinkActive="active">
            <i class="bi bi-bag me-2"></i>My Orders
          </a>
        </div>
      </div>
    </div>

    <div class="col-lg-9">
      <!-- Account Overview -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="bi bi-speedometer2 me-2"></i>Account Overview
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-3 mb-3">
              <div class="text-center">
                <div class="h3 text-primary">{{ userStats?.totalOrders || 0 }}</div>
                <small class="text-muted">Total Orders</small>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="text-center">
                <div class="h3 text-success">{{ userStats?.completedOrders || 0 }}</div>
                <small class="text-muted">Completed</small>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="text-center">
                <div class="h3 text-warning">{{ userStats?.pendingOrders || 0 }}</div>
                <small class="text-muted">Pending</small>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="text-center">
                <div class="h3 text-info">Â£{{ userStats?.totalSpent || 0 | number:'1.2-2' }}</div>
                <small class="text-muted">Total Spent</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Orders -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <h5 class="mb-0">
            <i class="bi bi-clock-history me-2"></i>Recent Orders
          </h5>
          <a routerLink="/user/orders" class="btn btn-outline-primary btn-sm">
            View All
          </a>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Order ID</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Total</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngIf="userProfile && userProfile.totalOrders === 0">
                  <td colspan="5" class="text-center text-muted">
                    <i class="bi bi-bag-x display-6"></i>
                    <p class="mt-2">No orders yet</p>
                    <a routerLink="/products" class="btn btn-primary btn-sm">
                      Start Shopping
                    </a>
                  </td>
                </tr>
                <tr *ngIf="userProfile && userProfile.totalOrders > 0">
                  <td colspan="5" class="text-center text-muted">
                    <p class="mt-2">You have {{ userProfile.totalOrders }} order(s)</p>
                    <a routerLink="/user/orders" class="btn btn-primary btn-sm">
                      View All Orders
                    </a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Profile Edit Form -->
      <div class="card shadow-sm mb-4" *ngIf="isEditing">
        <div class="card-header bg-light">
          <h5 class="mb-0">
            <i class="bi bi-pencil me-2"></i>Edit Profile
          </h5>
        </div>
        <div class="card-body">
          <form (ngSubmit)="saveProfile()">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="firstName" class="form-label">First Name</label>
                <input type="text" class="form-control" id="firstName" 
                       [(ngModel)]="editForm.firstName" name="firstName" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="lastName" class="form-label">Last Name</label>
                <input type="text" class="form-control" id="lastName" 
                       [(ngModel)]="editForm.lastName" name="lastName" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" 
                     [(ngModel)]="editForm.email" name="email" required>
            </div>
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">Save Changes</button>
              <button type="button" class="btn btn-outline-secondary" (click)="cancelEditing()">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Change Password Form -->
      <div class="card shadow-sm mb-4" *ngIf="isChangingPassword">
        <div class="card-header bg-light">
          <h5 class="mb-0">
            <i class="bi bi-shield-lock me-2"></i>Change Password
          </h5>
        </div>
        <div class="card-body">
          <form (ngSubmit)="savePassword()">
            <div class="mb-3">
              <label for="currentPassword" class="form-label">Current Password</label>
              <input type="password" class="form-control" id="currentPassword" 
                     [(ngModel)]="passwordForm.currentPassword" name="currentPassword" required>
            </div>
            <div class="mb-3">
              <label for="newPassword" class="form-label">New Password</label>
              <input type="password" class="form-control" id="newPassword" 
                     [(ngModel)]="passwordForm.newPassword" name="newPassword" required>
            </div>
            <div class="mb-3">
              <label for="confirmPassword" class="form-label">Confirm New Password</label>
              <input type="password" class="form-control" id="confirmPassword" 
                     [(ngModel)]="passwordForm.confirmPassword" name="confirmPassword" required>
            </div>
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary">Change Password</button>
              <button type="button" class="btn btn-outline-secondary" (click)="cancelChangingPassword()">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Account Settings -->
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h5 class="mb-0">
            <i class="bi bi-shield-check me-2"></i>Account Security
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">Password</h6>
                  <small class="text-muted">Click to change your password</small>
                </div>
                <button class="btn btn-outline-primary btn-sm" (click)="startChangingPassword()" *ngIf="!isChangingPassword">
                  Change
                </button>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">Account Actions</h6>
                  <small class="text-muted">Manage your account</small>
                </div>
                <button class="btn btn-outline-primary btn-sm" (click)="viewOrders()">
                  View Orders
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 