<div class="product-details-container">
  <div class="container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
      <a routerLink="/">Home</a>
      <i class="bi bi-chevron-right"></i>
      <a routerLink="/products">Products</a>
      <i class="bi bi-chevron-right"></i>
      <a routerLink="/products" [queryParams]="{gender: product?.audience}">{{ product?.audience | titlecase }}</a>
      <i class="bi bi-chevron-right"></i>
      <span class="current">{{ product?.name }}</span>
    </nav>

    @if(product)
    {
    <!-- Product Details -->
    <div class="product-details">
      <!-- Product Images -->
      <div class="product-images">
        <div class="main-image">
          <!-- <img [src]="'/assets/'+product.imagePath || selectedImage" alt="product.name" /> -->
          <img [src]="'/assets/'+ selectedImage" alt="product.name" />

          <div class="image-overlay">
            <button class="btn btn-light btn-sm zoom-btn" (click)="openImageModal()" data-bs-toggle="modal"
              data-bs-target="#productImagesModal" title="Open image">
              <i class="bi bi-zoom-in"></i>
            </button>
          </div>
        </div>



        @if (additionalProductImages && additionalProductImages.length > 0)
        {
        <div class="image-thumbnails">
          <div class="thumbnail" [class.active]="selectedImage === product.imagePath"
            (click)="selectImage(product.imagePath)">
            <img [src]="'/assets/'+product.imagePath" [alt]="product.name" title="Product image" />
          </div>
          @for (image of additionalProductImages; track image)
          {
          <div class="thumbnail" [class.active]="selectedImage === image.imagePath"
            (click)="selectImage(image.imagePath)">
            <img [src]="'/assets/'+image.imagePath" [alt]="product.name" title="Product image" />
          </div>
          }
        </div>
        }
      </div>

      <!-- Product Info -->
      <div class="product-info">
        <div class="product-header">
          <div class="product-badges">
            <span class="category-badge" [class]="product.audience">{{ product.audience }}</span>
            <span class="brand-badge">{{ product.brandName }}</span>
          </div>
          <h1 class="product-name">{{ product.name }}</h1>
          <div class="product-rating">
            <div class="stars">
              <i *ngFor="let star of [1, 2, 3, 4, 5]" [ngClass]="star <= rating ? 'bi bi-star-fill' : 'bi bi-star'"
                class="me-1">
              </i>
            </div>
            <span class="rating-text">{{ rating }}/5 ({{ reviewCount }} reviews)</span>
          </div>
        </div>

        <div class="product-price-section">
          <div class="price-info">
            <span class="current-price">£{{ product.price }}</span>
            <span class="original-price" *ngIf="product.originalPrice">£{{ product.originalPrice }}</span>
            <span class="discount-badge" *ngIf="product.originalPrice">
              -{{ getDiscountPercentage() }}%
            </span>
          </div>
          <div class="stock-info">
            <span class="stock-status" [class.in-stock]="product.stock > 0" [class.out-of-stock]="product.stock === 0">
              <i [ngClass]=" product.stock > 0 ? 'bi bi-check-circle' : 'bi bi-x-circle' "></i>
              {{ product.stock > 0 ? 'In Stock' : 'Out of Stock' }}
            </span>
            <span class="stock-count" *ngIf="product.stock > 0">
              {{ product.stock }} items available
            </span>
          </div>
        </div>



        <div class="product-description">
          <h3>Description</h3>
          <p>{{ product.description }}</p>
        </div>

        <!-- Product Features -->
        @if(productFeatures.length > 0)
        {
        <div class="product-features">
          <h3>Features</h3>
          <ul class="features-list">
            @for (feature of productFeatures; track feature)
            {
            <li>
              <i class="bi bi-check"></i>
              {{ feature }}
            </li>
            }
          </ul>
        </div>
        }

        @if(availableSizes.length > 0)
        {
        <!-- Size Selection -->
        <div class="size-selection">
          <h3>Select Size</h3>
          <div class="size-options">
            @for (size of availableSizes; track availableSizes)
            {
            <button class="btn btn-outline-primary" [class.selected]="selectedSize === size"
              [class.disabled]="!isSizeAvailable(size)" (click)="selectSize(size)">
              {{ size }}
            </button>
            }
          </div>
        </div>
        }

        <!-- Quantity Selection -->
        <div class="quantity-selection">
          <h3>Quantity</h3>
          <div class="quantity-controls">
            <button class="btn btn-outline-secondary" (click)="decreaseQuantity()" [disabled]="quantity <= 1"
              title="Decrease quantity">
              <i class="bi bi-dash"></i>
            </button>
            <span class="quantity-display">{{ quantity }}</span>
            <button class="btn btn-outline-secondary" (click)="increaseQuantity()" [disabled]="quantity >= maxQuantity"
              title="Increase quantity">
              <i class="bi bi-plus"></i>
            </button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn btn-primary add-to-cart-btn" [disabled]="product.stock === 0 || !selectedSize"
            (click)="addToCart()">
            <i class="bi bi-cart-plus"></i>
            Add to Cart
          </button>

          <button class="btn btn-outline-primary buy-now-btn" [disabled]="product.stock === 0 || !selectedSize"
            (click)="buyNow()">
            <i class="bi bi-lightning"></i>
            Buy Now
          </button>

          <button class="btn btn-outline-danger wishlist-btn" (click)="toggleWishlist()" title="Add to wishlist.">
            <i [class]="isInWishlist ? 'bi bi-heart-fill' : 'bi bi-heart'"></i>
          </button>
        </div>

        <!-- Product Meta -->
        <div class="product-meta">
          <div class="meta-item">
            <i class="bi bi-truck"></i>
            <span>Free shipping on orders over £50</span>
          </div>
          <div class="meta-item">
            <i class="bi bi-arrow-repeat"></i>
            <span>30-day return policy</span>
          </div>
          <div class="meta-item">
            <i class="bi bi-shield-check"></i>
            <span>Secure payment</span>
          </div>
        </div>
      </div>
    </div>
    }

    @if(!product)
    {
    <!-- Loading State -->
    <div class="loading-state">
      <span class="spinner-border spinner-border-lg me-2 text-primary" role="status"></span>
    </div>
    }

    <!-- Related Products -->
    @if (relatedProducts && relatedProducts.length>0)
    {
    <section class="related-products">
      <h2>Related Products</h2>
      <div class="related-products-grid">
        @for (relatedProduct of relatedProducts; track relatedProduct)
        {
        <div class="card related-product-card" role="button" (click)="navigateToProductDetails(relatedProduct.id)">
          <div class="product-image">

            <img class="card-img-top" [src]="'/assets/'+relatedProduct.imagePath" [alt]="relatedProduct.name"
              title="Product image" />
          </div>
          <div class="card-body">
            <h3 class="card-title">{{ relatedProduct.name }}</h3>
            <p class="brand">{{ relatedProduct.brandName }}</p>
            <p class="price">£{{ relatedProduct.price }}</p>
          </div>
        </div>
        }
      </div>
    </section>
    }
  </div>
</div>


<!-- Modal Body -->
<div class="modal fade" id="productImagesModal" tabindex="-1" role="dialog" aria-labelledby="modalTitleId"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-0">
        <div id="productImagesCarousel" class="carousel slide">
          <div class="carousel-inner">
            <div class="carousel-item active">
              <div class="carousel-image-wrapper">
                <img class="carousel-image" [src]="'/assets/'+ selectedImage" alt="product.name" />
              </div>
            </div>
            @for (image of additionalProductImages; track image)
            {
            <div class="carousel-item">
              <div class="carousel-image-wrapper">
                <img class="carousel-image" [src]="'/assets/'+ image.imagePath" alt="product.name" />
              </div>
            </div>
            }
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#productImagesCarousel"
            data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#productImagesCarousel"
            data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- In your component HTML -->
<div #errorToast class="toast position-fixed bottom-0 start-50 translate-middle-x text-bg-danger" role="alert"
  aria-live="assertive" aria-atomic="true">
  <div class="d-flex">
    <div class="toast-body">
      Please select a size before purchasing
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
      aria-label="Close"></button>
  </div>
</div>