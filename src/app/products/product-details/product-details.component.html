<div class="product-details-container">
  <div class="container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
      <a routerLink="/">Home</a>
      <i class="bi bi-chevron-right"></i>
      <a routerLink="/products">Products</a>
      <i class="bi bi-chevron-right"></i>
      <a routerLink="/products" [queryParams]="{gender: product?.audience}">{{ product?.audience | titlecase }}</a>
      <i class="bi bi-chevron-right"></i>
      <span class="current">{{ product?.name }}</span>
    </nav>

    <!-- Product Details -->
    <div class="product-details" *ngIf="product">
      <!-- Product Images -->
      <div class="product-images">
        <div class="main-image">
          <img [src]="'/assets/'+product.imagePath || selectedImage" alt="product.name" />
          <div class="image-overlay">
            <button class="btn btn-light btn-sm zoom-btn" (click)="openImageModal()">
              <i class="bi bi-zoom-in"></i>
            </button>
          </div>
        </div>

        <div class="image-thumbnails" *ngIf="productImages.length > 1">
          <div class="thumbnail" *ngFor="let image of productImages" [class.active]="selectedImage === image"
            (click)="selectImage(image)">
            <img [src]="image" [alt]="product.name" title="Product image" />
          </div>
        </div>
      </div>

      <!-- Product Info -->
      <div class="product-info">
        <div class="product-header">
          <div class="product-badges">
            <span class="category-badge" [class]="product.audience">{{ product.audience }}</span>
            <span class="brand-badge">{{ product.brandName }}</span>
          </div>
          <h1 class="product-name">{{ product.name }}</h1>
          <div class="product-rating">
            <div class="stars">
              <i *ngFor="let star of [1, 2, 3, 4, 5]" [ngClass]="star <= rating ? 'bi bi-star-fill' : 'bi bi-star'"
                class="me-1">
              </i>
            </div>
            <span class="rating-text">{{ rating }}/5 ({{ reviewCount }} reviews)</span>
          </div>
        </div>

        <div class="product-price-section">
          <div class="price-info">
            <span class="current-price">£{{ product.price }}</span>
            <span class="original-price" *ngIf="product.originalPrice">£{{ product.originalPrice }}</span>
            <span class="discount-badge" *ngIf="product.originalPrice">
              -{{ getDiscountPercentage() }}%
            </span>
          </div>
          <div class="stock-info">
            <span class="stock-status" [class.in-stock]="product.stock > 0" [class.out-of-stock]="product.stock === 0">
              <i [ngClass]=" product.stock > 0 ? 'bi bi-check-circle' : 'bi bi-x-circle' "></i>
              {{ product.stock > 0 ? 'In Stock' : 'Out of Stock' }}
            </span>
            <span class="stock-count" *ngIf="product.stock > 0">
              {{ product.stock }} items available
            </span>
          </div>
        </div>



        <div class="product-description">
          <h3>Description</h3>
          <p>{{ product.description }}</p>
        </div>

        <!-- Product Features -->
        <div class="product-features" *ngIf="productFeatures.length > 0">
          <h3>Features</h3>
          <ul class="features-list">
            <li *ngFor="let feature of productFeatures">
              <i class="bi bi-check"></i>
              {{ feature }}
            </li>
          </ul>
        </div>

        <!-- Size Selection -->
        <div class="size-selection" *ngIf="availableSizes.length > 0">
          <h3>Select Size</h3>
          <div class="size-options">
            <button class="btn btn-outline-primary" *ngFor="let size of availableSizes"
              [class.selected]="selectedSize === size" [class.disabled]="!isSizeAvailable(size)"
              (click)="selectSize(size)">
              {{ size }}
            </button>
          </div>
        </div>

        <!-- Quantity Selection -->
        <div class="quantity-selection">
          <h3>Quantity</h3>
          <div class="quantity-controls">
            <button class="btn btn-outline-secondary" (click)="decreaseQuantity()" [disabled]="quantity <= 1"
              title="Decrease quantity">
              <i class="bi bi-dash"></i>
            </button>
            <span class="quantity-display">{{ quantity }}</span>
            <button class="btn btn-outline-secondary" (click)="increaseQuantity()" [disabled]="quantity >= maxQuantity"
              title="Increase quantity">
              <i class="bi bi-plus"></i>
            </button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
          <button class="btn btn-primary add-to-cart-btn" [disabled]="product.stock === 0 || !selectedSize"
            (click)="addToCart()">
            <i class="bi bi-cart-plus"></i>
            Add to Cart
          </button>

          <button class="btn btn-outline-primary buy-now-btn" [disabled]="product.stock === 0 || !selectedSize"
            (click)="buyNow()">
            <i class="bi bi-lightning"></i>
            Buy Now
          </button>

          <button class="btn btn-outline-danger wishlist-btn" (click)="toggleWishlist()">
            <i [class]="isInWishlist ? 'bi bi-heart-fill' : 'bi bi-heart'"></i>
          </button>
        </div>

        <!-- Product Meta -->
        <div class="product-meta">
          <div class="meta-item">
            <i class="bi bi-truck"></i>
            <span>Free shipping on orders over £50</span>
          </div>
          <div class="meta-item">
            <i class="bi bi-arrow-repeat"></i>
            <span>30-day return policy</span>
          </div>
          <div class="meta-item">
            <i class="bi bi-shield-check"></i>
            <span>Secure payment</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-state" *ngIf="!product">
      <span class="spinner-border spinner-border-lg me-2 text-primary" role="status"></span>
    </div>

    <!-- Related Products -->
    <section class="related-products" *ngIf="relatedProducts.length > 0">
      <h2>Related Products</h2>
      <div class="related-products-grid">
        <div class="card related-product-card" *ngFor="let relatedProduct of relatedProducts">
          <img class="card-img-top" [src]="relatedProduct.imagePath" [alt]="relatedProduct.name"
            title="Product image" />
          <div class="card-body">
            <h3 class="card-title">{{ relatedProduct.name }}</h3>
            <p class="brand">{{ relatedProduct.brandName }}</p>
            <p class="price">£{{ relatedProduct.price }}</p>
          </div>
          <div class="card-footer">
            <button class="btn btn-primary" [routerLink]="['/products/details', relatedProduct.id]">
              View Details
            </button>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- In your component HTML -->
<div #errorToast class="toast position-fixed bottom-0 start-50 translate-middle-x text-bg-danger" role="alert"
  aria-live="assertive" aria-atomic="true">
  <div class="d-flex">
    <div class="toast-body">
      Please select a size before purchasing
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
      aria-label="Close"></button>
  </div>
</div>