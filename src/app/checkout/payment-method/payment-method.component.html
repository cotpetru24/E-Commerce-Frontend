<div class="card shadow-sm">
  <div class="card-header bg-success text-white">
    <h5 class="mb-0">
      <i class="bi bi-credit-card me-2"></i>Payment Method
    </h5>
  </div>
  <div class="card-body">
    <form (ngSubmit)="onSubmit()" #paymentForm="ngForm">
      <!-- Payment Method Selection -->
      <div class="mb-4">
        <label class="form-label">
          <i class="bi bi-credit-card me-2"></i>Select Payment Method
        </label>
        <div class="row">
          <div class="col-md-6 mb-3">
            <div class="form-check border rounded p-3" [ngClass]="{'border-primary': paymentData.method === 'card'}">
              <input 
                class="form-check-input" 
                type="radio" 
                name="paymentMethod" 
                id="card" 
                value="card"
                [(ngModel)]="paymentData.method"
                required
              >
              <label class="form-check-label" for="card">
                <i class="bi bi-credit-card me-2"></i>Credit/Debit Card
              </label>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="form-check border rounded p-3" [ngClass]="{'border-primary': paymentData.method === 'paypal'}">
              <input 
                class="form-check-input" 
                type="radio" 
                name="paymentMethod" 
                id="paypal" 
                value="paypal"
                [(ngModel)]="paymentData.method"
                required
              >
              <label class="form-check-label" for="paypal">
                <i class="bi bi-paypal me-2"></i>PayPal
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Credit Card Form -->
      <div *ngIf="paymentData.method === 'card'">
        <div class="mb-3">
          <label for="cardNumber" class="form-label">
            <i class="bi bi-credit-card me-2"></i>Card Number *
          </label>
          <input 
            type="text" 
            class="form-control" 
            id="cardNumber" 
            name="cardNumber"
            [(ngModel)]="paymentData.cardNumber"
            required
            placeholder="1234 5678 9012 3456"
            maxlength="19"
            [ngClass]="{'is-invalid': paymentForm.submitted && !paymentData.cardNumber}"
          >
          <div class="invalid-feedback" *ngIf="paymentForm.submitted && !paymentData.cardNumber">
            Card number is required.
          </div>
        </div>

        <div class="row">
          <div class="col-md-6 mb-3">
            <label for="expiryDate" class="form-label">
              <i class="bi bi-calendar me-2"></i>Expiry Date *
            </label>
            <input 
              type="text" 
              class="form-control" 
              id="expiryDate" 
              name="expiryDate"
              [(ngModel)]="paymentData.expiryDate"
              required
              placeholder="MM/YY"
              maxlength="5"
              [ngClass]="{'is-invalid': paymentForm.submitted && !paymentData.expiryDate}"
            >
            <div class="invalid-feedback" *ngIf="paymentForm.submitted && !paymentData.expiryDate">
              Expiry date is required.
            </div>
          </div>

          <div class="col-md-6 mb-3">
            <label for="cvv" class="form-label">
              <i class="bi bi-shield-lock me-2"></i>CVV *
            </label>
            <input 
              type="text" 
              class="form-control" 
              id="cvv" 
              name="cvv"
              [(ngModel)]="paymentData.cvv"
              required
              placeholder="123"
              maxlength="4"
              [ngClass]="{'is-invalid': paymentForm.submitted && !paymentData.cvv}"
            >
            <div class="invalid-feedback" *ngIf="paymentForm.submitted && !paymentData.cvv">
              CVV is required.
            </div>
          </div>
        </div>

        <div class="mb-3">
          <label for="cardholderName" class="form-label">
            <i class="bi bi-person me-2"></i>Cardholder Name *
          </label>
          <input 
            type="text" 
            class="form-control" 
            id="cardholderName" 
            name="cardholderName"
            [(ngModel)]="paymentData.cardholderName"
            required
            placeholder="Enter cardholder name"
            [ngClass]="{'is-invalid': paymentForm.submitted && !paymentData.cardholderName}"
          >
          <div class="invalid-feedback" *ngIf="paymentForm.submitted && !paymentData.cardholderName">
            Cardholder name is required.
          </div>
        </div>

        <div class="mb-3 form-check">
          <input 
            type="checkbox" 
            class="form-check-input" 
            id="saveCard"
            [(ngModel)]="paymentData.saveCard"
            name="saveCard"
          >
          <label class="form-check-label" for="saveCard">
            Save this card for future payments
          </label>
        </div>
      </div>

      <!-- PayPal Form -->
      <div *ngIf="paymentData.method === 'paypal'">
        <div class="alert alert-info">
          <i class="bi bi-info-circle me-2"></i>
          You will be redirected to PayPal to complete your payment securely.
        </div>
        <div class="mb-3">
          <label for="paypalEmail" class="form-label">
            <i class="bi bi-envelope me-2"></i>PayPal Email *
          </label>
          <input 
            type="email" 
            class="form-control" 
            id="paypalEmail" 
            name="paypalEmail"
            [(ngModel)]="paymentData.paypalEmail"
            required
            email
            placeholder="Enter your PayPal email"
            [ngClass]="{'is-invalid': paymentForm.submitted && !paymentData.paypalEmail}"
          >
          <div class="invalid-feedback" *ngIf="paymentForm.submitted && !paymentData.paypalEmail">
            Please enter a valid PayPal email address.
          </div>
        </div>
      </div>

      <!-- Billing Address -->
      <div class="mb-4">
        <h6 class="mb-3">
          <i class="bi bi-geo-alt me-2"></i>Billing Address
        </h6>
        <div class="form-check mb-3">
          <input 
            type="checkbox" 
            class="form-check-input" 
            id="sameAsShipping"
            [(ngModel)]="paymentData.sameAsShipping"
            name="sameAsShipping"
            (change)="onBillingAddressChange()"
          >
          <label class="form-check-label" for="sameAsShipping">
            Same as shipping address
          </label>
        </div>

        <div *ngIf="!paymentData.sameAsShipping">
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="billingFirstName" class="form-label">First Name *</label>
              <input 
                type="text" 
                class="form-control" 
                id="billingFirstName" 
                name="billingFirstName"
                [(ngModel)]="paymentData.billingFirstName"
                required
                placeholder="Enter first name"
              >
            </div>
            <div class="col-md-6 mb-3">
              <label for="billingLastName" class="form-label">Last Name *</label>
              <input 
                type="text" 
                class="form-control" 
                id="billingLastName" 
                name="billingLastName"
                [(ngModel)]="paymentData.billingLastName"
                required
                placeholder="Enter last name"
              >
            </div>
          </div>
          <div class="mb-3">
            <label for="billingAddress" class="form-label">Address *</label>
            <input 
              type="text" 
              class="form-control" 
              id="billingAddress" 
              name="billingAddress"
              [(ngModel)]="paymentData.billingAddress"
              required
              placeholder="Enter billing address"
            >
          </div>
        </div>
      </div>

      <!-- Order Summary -->
      <div class="card bg-light mb-4">
        <div class="card-body">
          <h6 class="card-title">
            <i class="bi bi-receipt me-2"></i>Order Summary
          </h6>
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal</span>
            <span>£{{ orderSummary.subtotal | number:'1.2-2' }}</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Shipping</span>
            <span>{{ orderSummary.shipping === 0 ? 'Free' : '£' + orderSummary.shipping | number:'1.2-2' }}</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between">
            <span class="h6 mb-0">Total</span>
            <span class="h6 mb-0 text-primary">£{{ orderSummary.total | number:'1.2-2' }}</span>
          </div>
        </div>
      </div>

      <!-- Terms and Conditions -->
      <div class="mb-4">
        <div class="form-check">
          <input 
            type="checkbox" 
            class="form-check-input" 
            id="acceptTerms"
            [(ngModel)]="paymentData.acceptTerms"
            name="acceptTerms"
            required
            [ngClass]="{'is-invalid': paymentForm.submitted && !paymentData.acceptTerms}"
          >
          <label class="form-check-label" for="acceptTerms">
            I agree to the <a href="#" class="text-decoration-none">Terms of Service</a> and <a href="#" class="text-decoration-none">Privacy Policy</a>
          </label>
          <div class="invalid-feedback" *ngIf="paymentForm.submitted && !paymentData.acceptTerms">
            You must agree to the terms and conditions.
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-between">
        <button 
          type="button" 
          class="btn btn-outline-secondary"
          (click)="goBack()"
        >
          <i class="bi bi-arrow-left me-2"></i>Back
        </button>
        <button 
          type="submit" 
          class="btn btn-success btn-lg"
          [disabled]="isLoading"
        >
          <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status"></span>
          <i class="bi bi-lock me-2" *ngIf="!isLoading"></i>
          {{ isLoading ? 'Processing Payment...' : 'Complete Order' }}
        </button>
      </div>
    </form>
  </div>
</div>
