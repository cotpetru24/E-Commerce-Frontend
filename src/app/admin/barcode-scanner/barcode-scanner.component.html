<div class="container mt-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a routerLink="/admin" class="text-decoration-none">
          <i class="bi bi-house me-1"></i>Admin Dashboard
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        <i class="bi bi-upc-scan me-1"></i>Barcode Scanner
      </li>
    </ol>
  </nav>

  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 mb-0">
          <i class="bi bi-upc-scan me-2"></i>Barcode Scanner
        </h1>
        <div class="btn-group" role="group">
          <button class="btn btn-outline-primary" 
                  [ngClass]="{'active': scanMode === 'camera'}"
                  (click)="setScanMode('camera')">
            <i class="bi bi-camera me-2"></i>Camera Scan
          </button>
          <button class="btn btn-outline-primary" 
                  [ngClass]="{'active': scanMode === 'manual'}"
                  (click)="setScanMode('manual')">
            <i class="bi bi-keyboard me-2"></i>Manual Entry
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-lg-8">
      <!-- Scanner Interface -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="bi bi-upc-scan me-2"></i>Scan Barcode
          </h5>
        </div>
        <div class="card-body">
          <!-- Camera Scanner -->
          <div *ngIf="scanMode === 'camera'" class="text-center">
            <div class="camera-container mb-3">
              <video #video id="video" width="100%" height="300" 
                     [class.d-none]="!isCameraActive"
                     style="border: 2px solid #dee2e6; border-radius: 8px;">
              </video>
              <canvas #canvas id="canvas" class="d-none"></canvas>
              
              <!-- Camera Placeholder -->
              <div class="camera-placeholder" *ngIf="!isCameraActive">
                <i class="bi bi-camera display-1 text-muted mb-3"></i>
                <h5 class="text-muted">Camera Scanner</h5>
                <p class="text-muted">Click the button below to start scanning</p>
                <button class="btn btn-primary btn-lg" (click)="startCamera()">
                  <i class="bi bi-camera me-2"></i>Start Camera
                </button>
              </div>
            </div>

            <div class="scanner-controls">
              <button class="btn btn-success me-2" 
                      (click)="startCamera()" 
                      [disabled]="isCameraActive">
                <i class="bi bi-camera me-2"></i>Start Camera
              </button>
              <button class="btn btn-danger me-2" 
                      (click)="stopCamera()" 
                      [disabled]="!isCameraActive">
                <i class="bi bi-camera-video-off me-2"></i>Stop Camera
              </button>
              <button class="btn btn-warning" 
                      (click)="captureBarcode()" 
                      [disabled]="!isCameraActive">
                <i class="bi bi-upc-scan me-2"></i>Scan Now
              </button>
            </div>

            <!-- Scan Result -->
            <div class="alert alert-success mt-3" *ngIf="scannedBarcode">
              <i class="bi bi-check-circle me-2"></i>
              <strong>Barcode Scanned:</strong> {{ scannedBarcode }}
            </div>
          </div>

          <!-- Manual Entry -->
          <div *ngIf="scanMode === 'manual'">
            <div class="mb-3">
              <label for="manualBarcode" class="form-label">
                <i class="bi bi-upc me-2"></i>Enter Barcode
              </label>
              <div class="input-group">
                <input type="text" 
                       class="form-control" 
                       id="manualBarcode"
                       [(ngModel)]="manualBarcode"
                       placeholder="Enter barcode number"
                       (keyup.enter)="processManualBarcode()">
                <button class="btn btn-primary" 
                        type="button"
                        (click)="processManualBarcode()">
                  <i class="bi bi-search me-2"></i>Search
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Information -->
      <div class="card shadow-sm" *ngIf="foundProduct">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            <i class="bi bi-box-seam me-2"></i>Product Found
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4">
              <img [src]="foundProduct.imagePath" 
                   [alt]="foundProduct.name" 
                   class="img-fluid rounded">
            </div>
            <div class="col-md-8">
              <h5>{{ foundProduct.name }}</h5>
              <p class="text-muted">{{ foundProduct.brandName }}</p>
              <div class="row">
                <div class="col-6">
                  <strong>Current Stock:</strong> {{ foundProduct.stock }}
                </div>
                <div class="col-6">
                  <strong>Price:</strong> Â£{{ foundProduct.price }}
                </div>
              </div>
              
              <hr>
              
              <div class="mb-3">
                <label for="quantityToAdd" class="form-label">
                  <i class="bi bi-plus-circle me-2"></i>Quantity to Add
                </label>
                <div class="input-group">
                  <input type="number" 
                         class="form-control" 
                         id="quantityToAdd"
                         [(ngModel)]="quantityToAdd"
                         min="1"
                         value="1">
                  <button class="btn btn-success" 
                          type="button"
                          (click)="updateStock()">
                    <i class="bi bi-check-circle me-2"></i>Update Stock
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Product Not Found -->
      <div class="card shadow-sm" *ngIf="productNotFound">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0">
            <i class="bi bi-exclamation-triangle me-2"></i>Product Not Found
          </h5>
        </div>
        <div class="card-body text-center">
          <i class="bi bi-box-x display-1 text-muted mb-3"></i>
          <h5 class="text-muted">Product with barcode "{{ scannedBarcode || manualBarcode }}" not found</h5>
          <p class="text-muted">Would you like to add this as a new product?</p>
          <button class="btn btn-primary btn-lg" (click)="addNewProduct()">
            <i class="bi bi-plus-circle me-2"></i>Add New Product
          </button>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <!-- Recent Scans -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-light">
          <h6 class="mb-0">
            <i class="bi bi-clock-history me-2"></i>Recent Scans
          </h6>
        </div>
        <div class="card-body">
          <div class="list-group list-group-flush">
            <div class="list-group-item" *ngFor="let scan of recentScans">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <strong>{{ scan.productName }}</strong>
                  <br>
                  <small class="text-muted">{{ scan.barcode }}</small>
                </div>
                <div class="text-end">
                  <span class="badge bg-success">+{{ scan.quantityAdded }}</span>
                  <br>
                  <small class="text-muted">{{ scan.timestamp | date:'HH:mm' }}</small>
                </div>
              </div>
            </div>
            <div class="text-center text-muted" *ngIf="recentScans.length === 0">
              <i class="bi bi-clock-history display-6"></i>
              <p class="mt-2">No recent scans</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card shadow-sm">
        <div class="card-header bg-light">
          <h6 class="mb-0">
            <i class="bi bi-lightning me-2"></i>Quick Actions
          </h6>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <button class="btn btn-outline-primary" (click)="exportScanHistory()">
              <i class="bi bi-download me-2"></i>Export History
            </button>
            <button class="btn btn-outline-secondary" (click)="viewInventory()">
              <i class="bi bi-box-seam me-2"></i>View Inventory
            </button>
            <button class="btn btn-outline-info" (click)="scanSettings()">
              <i class="bi bi-gear me-2"></i>Scanner Settings
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.camera-container {
  position: relative;
  min-height: 300px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.camera-placeholder {
  text-align: center;
  padding: 2rem;
}

.scanner-controls {
  margin-top: 1rem;
}
</style> 