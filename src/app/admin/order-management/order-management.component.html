<div class="container-fluid mt-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a routerLink="/admin" class="text-decoration-none">
          <i class="bi bi-house me-1"></i>Admin Dashboard
        </a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">
        <i class="bi bi-cart-check me-1"></i>Order Management
      </li>
    </ol>
  </nav>

  <div class="row">
    <div class="col-12">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="h2 mb-0">
            <i class="bi bi-cart-check me-2"></i>Order Management
          </h1>
          <p class="text-muted mb-0">Manage customer orders and track fulfillment</p>
        </div>
        <div class="btn-group" role="group">
          <button class="btn btn-outline-secondary" (click)="exportOrders()">
            <i class="bi bi-download me-1"></i>Export
          </button>
          <button class="btn btn-outline-info" (click)="refreshOrders()">
            <i class="bi bi-arrow-clockwise me-1"></i>Refresh
          </button>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="row mb-4">
        <div class="col-md-3 mb-3">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h4 class="mb-0">{{ orderStats.total }}</h4>
                  <small>Total Orders</small>
                </div>
                <i class="bi bi-cart display-6"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h4 class="mb-0">{{ orderStats.pending }}</h4>
                  <small>Pending</small>
                </div>
                <i class="bi bi-clock display-6"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card bg-info text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h4 class="mb-0">{{ orderStats.processing }}</h4>
                  <small>Processing</small>
                </div>
                <i class="bi bi-gear display-6"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card bg-success text-white">
            <div class="card-body">
              <div class="d-flex justify-content-between">
                <div>
                  <h4 class="mb-0">{{ orderStats.completed }}</h4>
                  <small>Completed</small>
                </div>
                <i class="bi bi-check-circle display-6"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Search and Filters -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 mb-3">
              <label for="searchInput" class="form-label">Search Orders</label>
              <div class="input-group">
                <input 
                  type="text" 
                  class="form-control" 
                  id="searchInput"
                  [(ngModel)]="searchTerm"
                  (input)="onSearchChange()"
                  placeholder="Search by order ID, customer email..."
                >
                <span class="input-group-text">
                  <i class="bi bi-search"></i>
                </span>
              </div>
            </div>
            <div class="col-md-3 mb-3">
              <label for="statusFilter" class="form-label">Status</label>
              <select class="form-select" id="statusFilter" [(ngModel)]="selectedStatus" (change)="onFilterChange()">
                <option value="">All Statuses</option>
                <option value="pending">Pending</option>
                <option value="processing">Processing</option>
                <option value="shipped">Shipped</option>
                <option value="delivered">Delivered</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <div class="col-md-3 mb-3">
              <label for="dateFilter" class="form-label">Date Range</label>
              <select class="form-select" id="dateFilter" [(ngModel)]="selectedDateRange" (change)="onFilterChange()">
                <option value="">All Time</option>
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
                <option value="quarter">This Quarter</option>
              </select>
            </div>
            <div class="col-md-2 mb-3">
              <label for="sortBy" class="form-label">Sort By</label>
              <select class="form-select" id="sortBy" [(ngModel)]="sortBy" (change)="onSortChange()">
                <option value="date-desc">Date (Newest)</option>
                <option value="date-asc">Date (Oldest)</option>
                <option value="total-desc">Total (High to Low)</option>
                <option value="total-asc">Total (Low to High)</option>
              </select>
            </div>
          </div>
        </div>
      </div>

      <!-- Orders Table -->
      <div class="card">
        <div class="card-header">
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Orders ({{ filteredOrders.length }})</h5>
            <div class="d-flex gap-2">
              <span class="badge bg-primary">{{ orderStats.total }} Total</span>
              <span class="badge bg-warning">{{ orderStats.pending }} Pending</span>
              <span class="badge bg-info">{{ orderStats.processing }} Processing</span>
              <span class="badge bg-success">{{ orderStats.completed }} Completed</span>
            </div>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Order ID</th>
                  <th>Customer</th>
                  <th>Date</th>
                  <th>Items</th>
                  <th>Total</th>
                  <th>Status</th>
                  <th>Payment</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let order of orders">
                  <td>
                    <strong>#{{ order.id }}</strong>
                    <br>
                    <small class="text-muted">{{ order.orderNumber }}</small>
                  </td>
                  <td>
                    <div>
                      <strong>{{ order.userEmail }}</strong>
                      <br>
                      <small class="text-muted">{{ order.customerName }}</small>
                    </div>
                  </td>
                  <td>
                    <div>
                      <strong>{{ formatDate(order.createdAt) }}</strong>
                      <br>
                      <small class="text-muted">{{ formatTime(order.createdAt) }}</small>
                    </div>
                  </td>
                  <td>
                    <span class="badge bg-secondary">{{ order.itemCount }} items</span>
                  </td>
                  <td>
                    <strong class="text-primary">Â£{{ order.total | number:'1.2-2' }}</strong>
                  </td>
                  <td>
                    <span [class]="getStatusClass(order.status)">{{ order.status | titlecase }}</span>
                  </td>
                  <td>
                    <span [class]="getPaymentClass(order.paymentStatus)">{{ order.paymentStatus | titlecase }}</span>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm" role="group">
                      <button class="btn btn-outline-info" (click)="viewOrder(order)" title="View Details">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button class="btn btn-outline-primary" (click)="updateStatus(order)" title="Update Status">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-outline-success" (click)="markShipped(order)" *ngIf="order.status === 'processing'" title="Mark Shipped">
                        <i class="bi bi-truck"></i>
                      </button>
                      <button class="btn btn-outline-warning" (click)="cancelOrder(order)" *ngIf="order.status !== 'cancelled' && order.status !== 'delivered'" title="Cancel Order">
                        <i class="bi bi-x-circle"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Loading State -->
          <div class="text-center p-4" *ngIf="isLoading">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading orders...</p>
          </div>

          <!-- Empty State -->
          <div class="text-center p-4" *ngIf="!isLoading && filteredOrders.length === 0">
            <i class="bi bi-cart display-1 text-muted"></i>
            <h4 class="mt-3">No orders found</h4>
            <p class="text-muted">Try adjusting your search or filters</p>
          </div>
        </div>

        <!-- Pagination -->
        <div class="card-footer" *ngIf="filteredOrders.length > 0">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to {{ Math.min(currentPage * itemsPerPage, filteredOrders.length) }} 
              of {{ orderStats.total }} orders
            </div>
            <nav>
              <ul class="pagination pagination-sm mb-0">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <a class="page-link" href="#" (click)="changePage(currentPage - 1)">Previous</a>
                </li>
                <li class="page-item" *ngFor="let page of getPageNumbers()" [class.active]="page === currentPage">
                  <a class="page-link" href="#" (click)="changePage(page)">{{ page }}</a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPages">
                  <a class="page-link" href="#" (click)="changePage(currentPage + 1)">Next</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 